![FINS](./docs/fins-logo.png "Firmware IP Node Specification")

Firmware Intellectual Property (IP) Node Specification (FINS) is an innovative software tool chain from Geon Technologies that defines a programmable logic processing module and automates the firmware design, verification, and integration workflows. The foundation of FINS is the definition of a modular IP (intellectual property) node with a human-readable JSON schema. The schema specification is the launching point for code generators to accelerate embedded systems development. Programmable logic development is automated for the following areas:

1. **IP Build and Simulation Workflows.** TCL and Makefile scripts generated by FINS automate the build and simulation of IP. IP modules can be built for compatibility with Xilinx Vivado IP Integrator or Intel Quartus Platform Designer which enables rapid insertion of IP in platform code and vendor reference designs.
2. **Rapid Reconfiguration.** FINS consolidates parameterization of IP into a single location and distributes these parameters across design tools with code generation of header-like package files.
3. **Properties and Ports Interfaces.** FINS generates HDL source code for a properties interface that enables repeatable software control of firmware and for a ports interface that standardizes firmware to firmware movement of data.

Additional detailed documentation is referenced here and is available at the following links:

* [Nodeset Integration](./docs/integration.md)
* [Node Development](./docs/development.md)
* [Node Parameters](./docs/parameters.md)
* [Node Properties](./docs/properties.md)
* [Node Ports](./docs/ports.md)
* [Node Filesets](./docs/filesets.md)
* [Node Sub-IP](./docs/sub-ip.md)

## Prerequisites

The software packages required to use FINS are:

* Xilinx Vivado (Tested with 2018.2, 2018.3) and/or Intel Quartus Prime Pro (Tested with 19.1)
* GNU Make
* Python 3.6 with setuptools 41.2.0
* Jinja2
* GNU Octave and/or Mathworks MATLAB

## Installation

Run the following commands from the root of this repository to install the FINS Python package:

> NOTE: You may need to upgrade your version of pip and setuptools before installing FINS. To perform this upgrade, execute the command: `sudo python3 -m pip install --upgrade pip setuptools`.

```bash
# Install the FINS software and "core" generator
$ sudo python3 -m pip install .
# Install the "vivado" generator plugin
$ sudo python3 -m pip install ./vivado
# Install the "quartus" generator plugin
$ sudo python3 -m pip install ./quartus
```

To uninstall FINS, run the following commands:

```bash
$ sudo python3 -m pip uninstall fins-quartus
$ sudo python3 -m pip uninstall fins-vivado
$ sudo python3 -m pip uninstall fins
```

## TL;DR Example

To run an example of a FINS IP, execute the following commands to build and simulate the test IP with Vivado:

> NOTES: Make sure you have sourced the Xilinx "settings64.sh" script for the version of Vivado you are using.

```bash
# Enter the test IP directory
$ cd ./test/node/
# Run the fins executable to generate the Vivado backend
$ fins -b vivado zynq.json
# Run the simulation in command line mode
$ make sim
```

When the commands have finished executing, notice the following files and folders (relative to the root of the `./test` directory):

* **Makefile**: This is the Makefile that provides the `all` and `sim` targets for the "test_top" IP.
* **./gen/core/**: This directory contains the generated code from the "core" backend that was used by the "test_top" IP.
* **./gen/vivado/**: This directory contains the generated scripts from the "vivado" backend that built and simulated the "test_top" IP.
* **./log/ip_create.log**: This log file contains the details of each step executed to build the "test_top" IP.
* **./log/ip_simulate.log**: This log file contains the details of each step executed to simulate the "test_top" IP.

## Learning FINS

To learn how to create a simple "power_converter" IP with FINS, see the tutorial [here](docs/tutorial1.md).

## Developing a FINS "Node"

A FINS "Node" is a single modular, resuable firmware Intellectual Property (IP). A Node serves as the foundation of FINS. See [here](docs/development.md) for more information on development of a "Node".

## Integrating a FINS "Nodeset"

A FINS "Nodeset" is the collection of FINS Nodes that exist within a programmable logic build. See [here](docs/integration.md) for more information on integrating a FINS "Nodeset".

## Notes

Here are few things to keep in mind when developing FINS IP:

* Xilinx's AXI Interconnect only supports 32bit data widths for AXI4-Lite, but Intel's AXI Interconnect supports both 32bit and 64bit data widths of the AXI4-Lite standard.
* Xilinx's AXI Interconnect creates slave AXI4-Lite byte-indexed buses, whereas Intel's AXI Interconnect creates slave AXI4-Lite word-indexed buses.
* FINS currently generates only VHDL for all HDL code. Verilog user code may require a translation layer of properties and ports records.
* When switching between vendors, you will need to change the part specified in the FINS Node JSON file. You may also find it convenient to specify a top-level FINS parameter to define the vendor that can be used in the HDL in "generate" statements.
* The "quartus" backend does not support a Verilog file as its top-level source file.

The AXI4-Lite buses and AXI4-Stream buses used in the top-level source file have strict requirements for their signals used and their naming. Every bus must have both clock and reset with signal names `aclk` and `aresetn`, respectively. The naming conventions are listed below.

* AXI4-Lite: `["m" or "s"][OPTIONAL_DECIMAL_NUMBER]_axi_[OPTIONAL_BUS_NAME]_[SIGNAL_NAME]`
* AXI4-Stream: `["m" or "s"][OPTIONAL_DECIMAL_NUMBER]_axis_[PORT_NAME]_[SIGNAL_NAME]`

## Contributing to FINS

To develop FINS templates or Python code, it is strongly recommended to use a virtual environment with an "editable" install:

```bash
$ sudo pip3 install virtualenv
$ python3 -m venv env
$ source env/bin/activate
$ pip3 install -e .
$ pip3 install -e ./vivado
$ pip3 install -e ./quartus
```

Any new code must be able to build and simulate the test IP for both Vivado and Quartus. To run both tests, execute the following commands:

> NOTE: These tests require both Octave and MATLAB. Make sure Quartus is in your `$PATH` environmental variable and the Vivado "settings64.sh" script is sourced!

```bash
$ cd ./test/node/
$ fins -b vivado zynq.json
$ make sim
$ make clean-all
$ fins -b quartus cycloneV.json
$ make sim
```

New code must also be able to parse FINS Nodeset JSON files. To run the nodeset test, execute the following commands:

```bash
$ cd ./test/nodeset/
$ fins nodeset.json
```
